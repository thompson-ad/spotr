# Spotr - Personal Trainer Assistant

## Project Overview

**Spotr** is a personal trainer assistant that leverages a **Retrieval-Augmented Generation (RAG) system** to generate personalized workout routines for users. The system integrates:

- **Airtable** as the data source for exercises.
- **SQLite** as the local database for fast exercise retrieval.
- **OpenAI GPT-4** (or similar models) to create workout plans based on user inputs, using the retrieved exercise data.

The app aims to provide accurate, constraint-compliant, and high-quality workout recommendations by combining AI with a curated exercise knowledge base.

## Workflow Summary

1. **Data Fetching** (Done):

   - Fetch exercise data from Airtable (tables: Chest, Back, Shoulders, Arms, Legs, Core).
   - Store the fetched data in a JSON file (`movements.json`).

2. **Seeding the SQLite Database** (In Progress):

   - Insert the fetched data from `movements.json` into a local SQLite database (`data.db`).
   - Use transactions and optimized write operations to ensure fast, reliable seeding.

3. **Data Enrichment** (Upcoming):

   - Add additional metadata to exercises, such as muscle groups, difficulty level, and equipment.
   - Enrichment can be manual (via Airtable) or automated (via scripts or APIs).

4. **Retrieval Mechanism** (Upcoming):

   - Build the retrieval system to query the SQLite database for exercises based on user inputs.
   - Allow for filtering by muscle group, difficulty, equipment, etc.

5. **Language Model Integration** (Upcoming):

   - Integrate GPT-4 (or similar) to generate personalized workout routines using the retrieved exercises as a base.
   - Ensure constraint compliance so that only exercises from the SQLite database are recommended.

6. **Response Validation** (Upcoming):
   - Add a validation layer to ensure that responses generated by the language model adhere to the data in the SQLite database.

---

## Outstanding Actions (In Order of Priority)

1. **Complete the Seeding Process** (In Progress)

   - Review and test the `writeMovements.ts` script to ensure that it correctly writes data to the SQLite database.
   - Verify that the table structure (`movements`) matches the fields from the Airtable data and that all records are inserted properly.

2. **Design and Implement the Retrieval Mechanism** (Next Step)

   - Build a system that queries the SQLite database based on user inputs.
   - Add filtering capabilities to allow for searching by body part, difficulty, equipment, etc.

3. **Begin Data Enrichment** (After Retrieval Mechanism)

   - Decide on the enrichment strategy (manual via Airtable or automated).
   - Implement enrichment for key fields (muscle groups, difficulty levels, equipment).

4. **Integrate Language Model** (After Data Enrichment)

   - Set up the connection to GPT-4 (or similar model) to generate personalized workouts based on the enriched exercise data.
   - Create prompts that combine user inputs with retrieved exercises from the SQLite database.

5. **Response Validation** (Final Step)
   - Build a validation layer to ensure that GPT-4 responses are compliant with the exercise data in SQLite.
   - Implement error handling and validation rules to prevent non-compliant recommendations.

---

## Completed Actions (Marked as Done)

1. **Fetch Data from Airtable** (Done)

   - Successfully fetched all exercise data from Airtable (tables: Chest, Back, Shoulders, Arms, Legs, Core).
   - Stored fetched data in `data/movements.json` for use in seeding the SQLite database.

2. **Set Up Environment Variables** (Done)
   - Moved the Airtable API key into an environment variable using `dotenv` to keep sensitive data secure.

---

## Outstanding Decisions (In Order of Priority)

1. **Data Enrichment Strategy**:

   - Should enrichment be handled manually (updating Airtable with additional fields) or automated (using a script or external API)?
   - If automated, which method or tool will be used for data enrichment?

2. **Retrieval Mechanism Filtering**:

   - What criteria will the retrieval mechanism filter by (e.g., muscle group, difficulty, equipment)?
   - Will users be able to combine filters (e.g., beginner chest exercises with dumbbells)?

3. **Integration with GPT-4**:
   - Should GPT-4 generate the workout routines dynamically (based on real-time retrieval) or use pre-generated templates?
   - How much information should be passed to the language model for generating personalized workouts (e.g., full list of exercises vs. filtered results)?

---

## How to Use This Project

### Requirements

- Node.js
- SQLite3
- Airtable (with API access)
- OpenAI API (optional, for GPT integration)

### How to Run

1. Install dependencies:
   ```bash
   npm install
   ```
2. Set up environment variables:
   Add your airtable API key to `.env`.
   ```bash
   AIRTABLE_API_KEY=your_airtable_api_key
   ```
3. fetch movements from airtable:

   ```bash
   npx ts-node scripts/fetch-data.ts
   ```

4. Write data to the datbase:

   ```bash
   npx ts-node scripts/writeMovements.ts
   ```

## Script Sequencing

### **1. Initial Setup: Fetching Data from Airtable**

This step fetches the workout data from Airtable and stores it locally in a JSON file (`movements.json`). This is the first point in the data lifecycle where the data enters your system.

#### Script: `fetchMovements.ts`

This script fetches all records from the Airtable tables, flattens them into a single array, and writes the result to `data/movements.json`.

**Steps:**

- Fetches records from all tables (e.g., Chest, Back, etc.).
- Writes the flattened data to a JSON file.

```bash
node scripts/fetchMovements.ts
```

**How it works:**

- Fetches workout data from Airtable.
- Writes the output to `data/movements.json`.

---

### **2. Insert or Update Data in the SQLite Database**

Once you’ve fetched the data from Airtable and stored it in `data/movements.json`, you need to insert this data into the SQLite database. This script ensures that **new records are inserted**, and existing records are **updated while preserving enriched fields** (if they exist).

#### Script: `writeMovements.ts`

This script reads from `data/movements.json`, inserts or updates records into the SQLite database, and ensures that **enriched fields** (like `primary_targets`, `fatigue_rating`, etc.) are preserved if they exist.

**Steps:**

- Reads the JSON file from `data/movements.json`.
- Creates the SQLite table `movements` (if it doesn’t exist).
- Inserts or updates each movement in the database, preserving the enriched fields.

```bash
node scripts/writeMovements.ts
```

**How it works:**

- Reads from `data/movements.json`.
- Inserts or updates the database with the core data from Airtable.
- Ensures enriched fields like `primary_targets` and `complexity` are not overwritten if they exist.

---

### **3. Data Enrichment (WIP)**

---

### **4. Database Migration (Handling Schema Changes)**

If at any point you need to update the database schema (e.g., adding new fields or modifying existing ones), you’ll need to run a migration script. The migration script will create a new table schema, migrate data from the old table, and then replace the old table with the new one.

#### Script: `migrateSchemaUpdate.ts`

This script handles schema updates by:

- Creating a new table with the updated schema.
- Migrating data from the old table, handling `NULL` values.
- Replacing the old table with the new one.

**Steps:**

- Creates a new table with the updated schema (`movements_new`).
- Copies data from the old table (`movements`).
- Drops the old table and renames the new table to `movements`.

```bash
node scripts/migrateSchemaUpdate.ts
```

**How it works:**

- Updates the schema of the database.
- Copies existing data while setting default values for new fields.

---

### **5. Future Data Syncs from Airtable (Ongoing Updates)**

In the future, when you update data in Airtable, you’ll need to re-sync this updated data to your database. However, you want to make sure that **existing enriched data isn’t overwritten** during the sync.

#### Script: `fetchMovements.ts` (to fetch new Airtable data)

You’ll first fetch the updated data from Airtable, as you did in the initial setup.

```bash
node scripts/fetchMovements.ts
```

#### Script: `writeMovements.ts` (to update the database)

Then, you’ll run the `writeMovements.ts` script again to update the SQLite database with the new data. This script will ensure that core fields from Airtable are updated, but **enriched fields remain untouched**.

```bash
node scripts/writeMovements.ts
```

**How it works:**

- Fetches updated data from Airtable and updates the core fields.
- Enriched fields are preserved.

---
